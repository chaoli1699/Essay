/*! This file is created by gold.xitu.io. */
webpackJsonp([34],{261:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function isValidImageFileType(file,typeList){return createBufferReader(file).then(getHeader).then(checkHeader.bind(null,typeList))}function createBufferReader(file){return new _promise2["default"](function(resolve,reject){var fileReader=new FileReader;fileReader.onload=function(e){return resolve(e.target.result)},fileReader.onerror=function(e){return reject(e)},fileReader.readAsArrayBuffer(file)})}function getHeader(buffer){return new Uint8Array(buffer).subarray(0,4).reduce(function(res,data){return res+data.toString(16)},"")}function checkHeader(typeList,header){for(var i=0;i<formatList.length;i++)if(formatList[i].regx.test(header))return typeList.indexOf(formatList[i].name)!==-1;return!1}Object.defineProperty(exports,"__esModule",{value:!0});var _promise=__webpack_require__(20),_promise2=_interopRequireDefault(_promise);exports.isValidImageFileType=isValidImageFileType;var formatList=[{name:"jpg",regx:/^ffd8ff/},{name:"gif",regx:/^474946/},{name:"png",regx:/89504e47/},{name:"webp",regx:/57454250/},{name:"bmp",regx:/^424d/},{name:"any",regx:/./}]},710:function(module,exports,__webpack_require__){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var _assign=__webpack_require__(63),_assign2=_interopRequireDefault(_assign),_typeof2=__webpack_require__(29),_typeof3=_interopRequireDefault(_typeof2),_actions=__webpack_require__(21),actions=_interopRequireWildcard(_actions),_helpers=__webpack_require__(25),_file=__webpack_require__(261),SubmitEntry=AV.Object.extend("SubmitEntry"),resetForm=function(){return{screenshot:"",screenshotDesc:"",deleteScreenshot:!1,title:"",url:"",content:"",original:!1,gfw:!1,english:!1,category:"",showCategoryAlert:!1,submitting:!1,foundEntry:null,tags:[],vote:!1,inGold:!1}};module.exports={vuex:{getters:{user:function(state){return state.user},newEntryForm:function(state){return state.newEntryForm}},actions:actions},data:function(){return{form:resetForm(),tagWord:"",selectedTagIndex:-1,tags:[],CATEGORIES:_helpers.CATEGORIES,editSubmitEntry:null,$form:null,$file:null}},created:function(){var _this=this;this.form.title=this.newEntryForm.title,this.form.url=this.newEntryForm.url,this.checkUrl(),this.$watch("form.url",function(){_this.checkUrl()})},ready:function(){(0,_helpers.autosizeTextarea)(this.$el.querySelectorAll("textarea")),this.$form=this.$el.querySelector("form"),this.$file=this.$form.querySelector('input[type="file"]'),this.loadTag()},route:{data:function(){this.$route.query&&this.$route.query.id&&this.loadSubmitEntry(this.$route.query.id)}},computed:{suggestedTags:function(){var _this2=this;if(""===this.tagWord)return[];var _ret=function(){var haveIt=new RegExp(_this2.tagWord,"g");return{v:_this2.tags.filter(function(item){return!(!haveIt.test(item.get("title"))&&!haveIt.test(item.get("alias")))}).slice(0,10)}}();return"object"===("undefined"==typeof _ret?"undefined":(0,_typeof3["default"])(_ret))?_ret.v:void 0}},methods:{loadSubmitEntry:function(id){var _this3=this,query=new AV.Query("SubmitEntry");query.get(id).then(function(submitEntry){_this3.editSubmitEntry=submitEntry,_this3.setFormFromEntry(submitEntry),_this3.checkUrl()})["catch"](_helpers.outputError)},setFormFromEntry:function(entry){var form=this.form,data=entry.attributes;form.screenshot=data.screenshot&&data.screenshot.url()||"",form.screenshotDesc="",form.title=data.title,form.url=data.originalUrl,form.content=data.content,form.original=data.original,form.gfw=data.gfw,form.english=data.english,form.category=data.category;var relation=entry.relation("tags");relation.targetClassName&&relation.query().find().then(function(tags){return form.tags=tags})["catch"](_helpers.outputError)},loadTag:function(){var _this4=this,query=new AV.Query("Tag");query.limit(1e3).find().then(function(tags){_this4.tags=tags})},checkUrl:function(){var _this5=this;this.form.url=this.form.url.trim();var url=this.form.url;if((0,_helpers.validUrl)(url)){if(this.form.inGold=/^(https?\:\/\/)?gold\.xitu\.io/.test(url),this.form.inGold)return;var urlAlternate="/"==url[url.length-1]?url.slice(0,url.length-1):url+"/",exactQuery=new AV.Query(Entry).equalTo("originalUrl",url),alternateQuery=new AV.Query(Entry).equalTo("originalUrl",urlAlternate);AV.Query.or(exactQuery,alternateQuery).include("user").first().then(function(entry){_this5.currentEditingEntry&&_this5.currentEditingEntry.id==entry.id?_this5.form.foundEntry=null:_this5.form.foundEntry=entry})["catch"](_helpers.outputError)}else this.form.foundEntry=null},previewFile:function(e){var _this6=this,file=e.target.files[0];(0,_file.isValidImageFileType)(file,["jpg","png"]).then(function(valid){valid?(_this6.form.screenshot=URL.createObjectURL(file),_this6.form.screenshotDesc=file.name,_this6.form.deleteScreenshot=!1):(alert("文件格式只支持：jpg、jpeg 和 png"),_this6.clearFile())})},clearFile:function(){this.form.screenshot="",this.form.screenshotDesc="",this.form.deleteScreenshot=!0,this.$file.value=""},tagInput:function(e){switch(e.keyCode){case 38:this.selectTag(!1),e.preventDefault();break;case 40:this.selectTag(!0),e.preventDefault();break;case 13:this.addSelectedTag(),e.preventDefault();break;default:this.selectedTagIndex=-1}},selectTag:function(down){if(down){var index=this.selectedTagIndex+1;index<this.suggestedTags.length&&(this.selectedTagIndex=index)}else{var _index=this.selectedTagIndex-1;_index>=0&&(this.selectedTagIndex=_index)}},addSelectedTag:function(){this.selectedTagIndex>=0&&this.addTag(this.suggestedTags[this.selectedTagIndex])},addTag:function(toBeAddedTag){this.form.tags.every(function(tag){return tag.id!=toBeAddedTag.id})&&this.form.tags.push(toBeAddedTag),this.tagWord=""},removeTag:function(toBeRemovedTag){var toBeRemovedIndex=this.form.tags.indexOf(toBeRemovedTag);toBeRemovedIndex>-1&&this.form.tags.splice(toBeRemovedIndex,1)},clearForm:function(){this.tagWord="",this.suggestedTags=[],this.clearFile(),(0,_assign2["default"])(this.form,resetForm())},saveEntry:function(submitEntry){var _this7=this;return this.form.submitting=!0,submitEntry.save().then(function(submitEntry){var tags=_this7.form.tags;if(_this7.createAlert("投稿发布成功"),tags.length>0){var relation=submitEntry.relation("tags");relation.add(tags),submitEntry.set("tagsTitleArray",tags.map(function(tag){return tag.get("title")})).save()["catch"](_helpers.outputError)}_this7.$route.router.replace({name:"submit-entry-success"}),_this7.clearForm()})["catch"](function(error){_this7.submitting=!1,(0,_helpers.outputError)(error)})},submitEntry:function(e){var _this8=this;return this.checkCategory()?void(this.$form.checkValidity()&&!function(){e.preventDefault();var submitEntry=void 0;_this8.editSubmitEntry?submitEntry=_this8.editSubmitEntry:(submitEntry=new SubmitEntry,submitEntry.set("user",AV.User.current())),submitEntry.set("url",_this8.form.url).set("title",xssFilter.process(_this8.form.title)).set("originalUrl",_this8.form.url).set("content",xssFilter.process(_this8.form.content)).set("original",_this8.form.original).set("gfw",_this8.form.gfw).set("english",_this8.form.english).set("category",_this8.form.category).set("verify",!1).set("success",!1);var file=_this8.$file.files[0];if(file){_this8.form.submitting=!0;var avFile=new AV.File(file.name,file);avFile.save().then(function(file){submitEntry.set("screenshot",file),_this8.saveEntry(submitEntry)})}else _this8.form.deleteScreenshot&&submitEntry.set("screenshot",null),_this8.saveEntry(submitEntry)}()):e.preventDefault()},checkCategory:function(){return!!this.form.category||(this.form.showCategoryAlert=!0,!1)}}}},881:function(module,exports){module.exports='<div class=view><nav class=bg><div class=container><div class=actions><a href=/guidelines target=_blank class=action><i class=ion-happy-outline></i><span>分享指南</span></a></div></div></nav><div class=container><form id=new-entry><h2 class=submit-entry-title>推荐文章到掘金</h2><div class=submit-entry-sub-title>感谢分享，文章的审核时间约1-2个工作日</div><div class=flex><div class="action new-entry-info"><input placeholder="分享网址 https://gold.xitu.io/example" type=url v-model=form.url name=url required=required autofocus=autofocus /><p v-if=form.foundEntry class="tag true"><i class=ion-alert></i><span>已被用户<strong>{{form.foundEntry.get(\'user\').get(\'username\')}}</strong> 分享过：<strong @click=$Route.routeEntry(form.foundEntry) class=text-pointer>{{form.foundEntry.get(\'title\')}}</strong></span></p><p v-if=form.inGold class="tag true"><i class=ion-alert></i><span>请不要重复分享掘金站内的内容</span></p><input placeholder=标题 type=text v-model=form.title name=title required=required /><textarea placeholder=描述 v-model=form.content name=content rows=3 required=required></textarea><p><label>分类</label><span class=tags><span v-for="category in CATEGORIES" @click="form.category = $key" :class="{true: form.category == $key}" class=tag>{{category.name}}</span></span></p><div v-if="form.showCategoryAlert &amp;&amp; !form.category" class="tag true"><i class=ion-alert></i><span>请选择一个分类</span></div><div class=tags-input><label>标签</label><span v-if="form.tags.length &gt; 0" class=tags><span v-for="tag in form.tags" @click=removeTag(tag) class="tag true">{{tag.get(\'title\')}}</span></span><span :class="{open: suggestedTags.length &gt; 0}" class=dropdown><ul class="dropdown-list suggested-tags"><li v-for="tag in suggestedTags" @click=addTag(tag) :class="{selected: $index == selectedTagIndex}" class=suggested-tag>{{tag.get(\'title\')}}</li></ul><input placeholder=可选填 type=text v-model=tagWord @keydown=tagInput class="inline new-tag-input"/></span></div><article class=submit><input type=submit :value="editSubmitEntry ? &quot;保存&quot; : &quot;投稿&quot;" @click=submitEntry :disabled=!!form.foundEntry class=fullwidth /></article></div><div class=action><div class=screenshot-input><div v-show=!form.screenshot class=screenshot-hint><i class=ion-image></i><span>拖动一张照片进来</span><p>或</p><span class=text-blue>点击上传</span></div><input type=file name=screenshot @change=previewFile /><div v-show=form.screenshot class=screenshot-container><img :src.wait=form.screenshot /><div @click=clearFile class="delete text-pointer"><i class=ion-trash-a></i><br/>删除图片 {{form.screenshotDesc}}</div></div></div><p><label>其他</label><span class=tags><span @click="form.original = !form.original" :class="{true: form.original}" class=tag>原创</span><span @click="form.gfw = !form.gfw" :class="{true: form.gfw}" class=tag>墙外</span><span @click="form.english = !form.english" :class="{true: form.english}" class=tag>英文</span></span></p></div></div></form><div v-if=form.submitting class="submitting vertical-center text-center"><h1><img src=https://gold-cdn.xitu.io/images/logo.svg class="inline logo"/></h1><p>上传中</p></div></div></div>'},984:function(module,exports,__webpack_require__){var __vue_script__,__vue_template__,__vue_styles__={};__vue_script__=__webpack_require__(710),__vue_template__=__webpack_require__(881),module.exports=__vue_script__||{},module.exports.__esModule&&(module.exports=module.exports["default"]);var __vue_options__="function"==typeof module.exports?module.exports.options||(module.exports.options={}):module.exports;__vue_template__&&(__vue_options__.template=__vue_template__),__vue_options__.computed||(__vue_options__.computed={}),Object.keys(__vue_styles__).forEach(function(key){var module=__vue_styles__[key];__vue_options__.computed[key]=function(){return module}})}});